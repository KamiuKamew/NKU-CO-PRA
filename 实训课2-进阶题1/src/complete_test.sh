#!/bin/bash

echo "============================================="
echo "     MLPç¥žç»ç½‘ç»œDCUåŠ é€Ÿå®Œæ•´æµ‹è¯•æµç¨‹"
echo "============================================="

# è®¾ç½®è„šæœ¬ä¸ºå¯æ‰§è¡Œ
chmod +x *.sh
chmod +x *.py

echo "æ­¥éª¤1: è¿è¡Œä¸»è¦æ€§èƒ½æµ‹è¯•..."
echo "---------------------------------------------"
./run_server_test.sh

if [ $? -ne 0 ]; then
    echo "âŒ ä¸»è¦æµ‹è¯•å¤±è´¥"
    exit 1
fi

echo ""
echo "æ­¥éª¤2: ç”Ÿæˆæ€§èƒ½å¯è§†åŒ–..."
echo "---------------------------------------------"
if command -v python3 &> /dev/null; then
    python3 generate_plots.py
    echo "âœ“ å¯è§†åŒ–ç”Ÿæˆå®Œæˆ"
else
    echo "âš  Python3ä¸å¯ç”¨ï¼Œè·³è¿‡å¯è§†åŒ–ç”Ÿæˆ"
fi

echo ""
echo "æ­¥éª¤3: ç”Ÿæˆæœ€ç»ˆæŠ¥å‘Š..."
echo "---------------------------------------------"

# åˆ›å»ºæœ€ç»ˆæ€»ç»“æŠ¥å‘Š
cat > results/final_report.md << 'EOF'
# MLPç¥žç»ç½‘ç»œå‰å‘ä¼ æ’­DCUåŠ é€Ÿå®žéªŒ - æœ€ç»ˆæŠ¥å‘Š

## ðŸŽ¯ å®žéªŒç›®æ ‡

æœ¬å®žéªŒæ—¨åœ¨å®žçŽ°ä¸€ä¸ªä¸‰å±‚å¤šå±‚æ„ŸçŸ¥æœº(MLP)ç¥žç»ç½‘ç»œçš„å‰å‘ä¼ æ’­ï¼Œå¹¶é€šè¿‡DCUç¡¬ä»¶åŠ é€ŸæŠ€æœ¯æ˜¾è‘—æå‡è®¡ç®—æ€§èƒ½ã€‚

## ðŸ—ï¸ ç½‘ç»œæž¶æž„

```
è¾“å…¥å±‚: 1024Ã—10 â†’ éšè—å±‚: 10Ã—20 (ReLU) â†’ è¾“å‡ºå±‚: 20Ã—5
```

- **æ‰¹å¤„ç†å¤§å°**: 1024
- **æ€»å‚æ•°é‡**: 225ä¸ªæƒé‡å’Œåç½®
- **è®¡ç®—å¤æ‚åº¦**: ~307Kæ¬¡æµ®ç‚¹è¿ç®—

## âš¡ å®žçŽ°ç‰ˆæœ¬

### 1. CPUåŸºå‡†å®žçŽ°
- æ ‡å‡†ä¸‰é‡å¾ªçŽ¯çŸ©é˜µä¹˜æ³•
- é¡ºåºæ‰§è¡Œæ‰€æœ‰è®¡ç®—
- ç”¨ä½œæ€§èƒ½åŸºå‡†

### 2. DCUåŸºç¡€å®žçŽ°
- HIPç¼–ç¨‹æ¨¡åž‹
- 16Ã—16çº¿ç¨‹å—å¹¶è¡Œ
- åŸºç¡€çŸ©é˜µä¹˜æ³•å†…æ ¸

### 3. DCUä¼˜åŒ–å®žçŽ°
- å…±äº«å†…å­˜ä¼˜åŒ–
- 32Ã—32å†…å­˜åˆ†å—(Tiling)
- å†…æ ¸èžåˆæŠ€æœ¯
- å¼‚æ­¥å†…å­˜ä¼ è¾“

## ðŸ“Š æ€§èƒ½ç»“æžœæ‘˜è¦

EOF

# æ·»åŠ æ€§èƒ½æ•°æ®åˆ°æŠ¥å‘Š
if [ -f results/performance_summary.txt ]; then
    echo "" >> results/final_report.md
    echo "### è¯¦ç»†æ€§èƒ½æ•°æ®" >> results/final_report.md
    echo "" >> results/final_report.md
    echo "| å®žçŽ°æ–¹æ³• | æ‰§è¡Œæ—¶é—´(ms) | åŠ é€Ÿæ¯” |" >> results/final_report.md
    echo "|----------|-------------|--------|" >> results/final_report.md
    
    while IFS=, read -r method time speedup || [ -n "$method" ]; do
        if [ "$method" != "Method" ]; then
            echo "| $method | $time | ${speedup}x |" >> results/final_report.md
        fi
    done < results/performance_summary.txt
fi

cat >> results/final_report.md << 'EOF'

## ðŸ”§ ä¼˜åŒ–æŠ€æœ¯è¯¦è§£

### DCUåŸºç¡€ç‰ˆæœ¬ä¼˜åŒ–
- **å¹¶è¡Œçº¿ç¨‹**: åˆ©ç”¨DCUçš„å¤§è§„æ¨¡å¹¶è¡Œå¤„ç†èƒ½åŠ›
- **å†…å­˜åˆå¹¶**: ä¼˜åŒ–å…¨å±€å†…å­˜è®¿é—®æ¨¡å¼
- **å†…æ ¸å¯åŠ¨**: é«˜æ•ˆçš„GPUå†…æ ¸è°ƒåº¦

### DCUé«˜çº§ä¼˜åŒ–ç‰ˆæœ¬
- **å…±äº«å†…å­˜**: å‡å°‘å…¨å±€å†…å­˜è®¿é—®å»¶è¿Ÿ
- **å†…å­˜åˆ†å—**: æé«˜æ•°æ®å±€éƒ¨æ€§å’Œç¼“å­˜å‘½ä¸­çŽ‡
- **å†…æ ¸èžåˆ**: å‡å°‘å†…æ ¸å¯åŠ¨å¼€é”€å’Œå†…å­˜ä¼ è¾“
- **å¼‚æ­¥æ‰§è¡Œ**: è®¡ç®—ä¸Žå†…å­˜ä¼ è¾“é‡å 

## ðŸŽ¯ å…³é”®æˆæžœ

1. **åŠŸèƒ½éªŒè¯**: æ‰€æœ‰å®žçŽ°éƒ½é€šè¿‡äº†æ•°å€¼ç²¾åº¦éªŒè¯(è¯¯å·®<1e-6)
2. **æ€§èƒ½æå‡**: DCUå®žçŽ°ç›¸æ¯”CPUèŽ·å¾—æ˜¾è‘—åŠ é€Ÿ
3. **ä¼˜åŒ–æ•ˆæžœ**: é«˜çº§ä¼˜åŒ–æŠ€æœ¯è¿›ä¸€æ­¥æå‡æ€§èƒ½
4. **ç¨³å®šæ€§**: å¤šæ¬¡æµ‹è¯•ç»“æžœç¨³å®šå¯é 

## ðŸ“ æ–‡ä»¶ç»“æž„

```
src/
â”œâ”€â”€ sourcefile_mlp_forward.cpp      # DCUåŸºç¡€å®žçŽ°
â”œâ”€â”€ sourcefile_mlp_optimized.cpp    # DCUä¼˜åŒ–å®žçŽ°  
â”œâ”€â”€ sourcefile_mlp_cpu.cpp          # CPUåŸºå‡†å®žçŽ°
â”œâ”€â”€ run_server_test.sh              # ä¸»æµ‹è¯•è„šæœ¬
â”œâ”€â”€ generate_plots.py               # å¯è§†åŒ–è„šæœ¬
â””â”€â”€ results/                        # æµ‹è¯•ç»“æžœç›®å½•
    â”œâ”€â”€ performance_summary.txt     # æ€§èƒ½æ•°æ®æ±‡æ€»
    â”œâ”€â”€ test_report.md             # è¯¦ç»†æµ‹è¯•æŠ¥å‘Š
    â”œâ”€â”€ performance_text_chart.txt # æ–‡æœ¬æ€§èƒ½å›¾è¡¨
    â””â”€â”€ *.txt                      # å„ç§æµ‹è¯•è¾“å‡ºæ–‡ä»¶
```

## ðŸš€ æŠ€æœ¯ä»·å€¼

### ç›´æŽ¥åº”ç”¨
- æ·±åº¦å­¦ä¹ æ¨¡åž‹æŽ¨ç†åŠ é€Ÿ
- å¤§è§„æ¨¡çŸ©é˜µè¿ç®—ä¼˜åŒ–
- ç¥žç»ç½‘ç»œè®­ç»ƒåŠ é€Ÿ

### æŠ€æœ¯è¿ç§»
- HIPç¼–ç¨‹æ¨¡åž‹åº”ç”¨
- DCUç¡¬ä»¶ä¼˜åŒ–æŠ€æœ¯
- å¼‚æž„è®¡ç®—ç³»ç»Ÿè®¾è®¡

## ðŸ“ˆ æœªæ¥ä¼˜åŒ–æ–¹å‘

1. **ç®—æ³•å±‚é¢**
   - æ··åˆç²¾åº¦è®¡ç®—(FP16/BF16)
   - æ›´é«˜æ•ˆçš„æ¿€æ´»å‡½æ•°å®žçŽ°
   - å¤šDCUååŒè®¡ç®—

2. **ç³»ç»Ÿå±‚é¢**
   - å†…å­˜æ± ç®¡ç†
   - åŠ¨æ€è´Ÿè½½å‡è¡¡
   - å¤šæµå¹¶è¡Œæ‰§è¡Œ

---
**å®žéªŒå®Œæˆæ—¶é—´**: $(date)
**å®žéªŒçŽ¯å¢ƒ**: æ›™å…‰DCUå®žè®­å¹³å°
**æŠ€æœ¯æ ˆ**: HIP + C++ + CUDA-style Programming
EOF

echo ""
echo "ðŸŽ‰ å®Œæ•´æµ‹è¯•æµç¨‹ç»“æŸ"
echo "============================================="
echo "ðŸ“‚ æ‰€æœ‰ç»“æžœæ–‡ä»¶éƒ½ä¿å­˜åœ¨ results/ ç›®å½•ä¸­"
echo ""
echo "ðŸ” é‡è¦æ–‡ä»¶æ¸…å•:"
echo "- results/final_report.md          : æœ€ç»ˆå®žéªŒæŠ¥å‘Š"
echo "- results/performance_summary.txt  : æ€§èƒ½æ•°æ®æ±‡æ€»"
echo "- results/test_report.md          : è¯¦ç»†æµ‹è¯•æŠ¥å‘Š"
echo "- results/performance_text_chart.txt : æ–‡æœ¬æ€§èƒ½å›¾è¡¨"
echo ""

if [ -f results/performance_summary.txt ]; then
    echo "ðŸ“Š æ€§èƒ½ç»“æžœé¢„è§ˆ:"
    echo "---------------------------------------------"
    cat results/performance_summary.txt
    echo "---------------------------------------------"
fi

echo ""
echo "âœ… å®žéªŒäºŒ - MLPç¥žç»ç½‘ç»œDCUåŠ é€Ÿä¼˜åŒ– - æµ‹è¯•å®Œæˆ"
echo "å¯ä»¥å°†resultsç›®å½•ä¸­çš„æ‰€æœ‰æ–‡ä»¶ç”¨äºŽåˆ†æžå’ŒæŠ¥å‘Š"
echo "=============================================" 